#!/usr/bin/env bash
set -e

if [ ! -f docker-compose.yml ]; then
  # docker-compose.yml does not exist and is to be downloaded from latest release - checking latest release generation at the moment
  # TODO: change to static 'STRATO_GENERATION=6' once STRATO 6.0.0 is released:
  STRATO_GENERATION=$(curl -s https://github.com/blockapps/strato-getting-started/releases/latest | sed 's/.*tag\/\([^ ]*\).*/\1/' | cut -c1-1)
else
  STRATO_VERSION_TAG=$(grep strato-version: docker-compose.yml | cut -d: -f2-)
  # Check if 6.0.0 release candidate
  if [[ "$STRATO_VERSION_TAG" =~ .*"5.5.0-".* ]]; then
    STRATO_GENERATION="6"
  else
    # Get generation from first character of STRATO version tag
    STRATO_GENERATION=$(cut -c1-1 <<< "${STRATO_VERSION_TAG}")
  fi
fi

if [ "${STRATO_GENERATION}" -eq "5" ]; then
  echo 'Using STRATO 5'
  source strato5.sh
else
  echo 'Using STRATO 6 or newer'
  source strato6.sh
fi
